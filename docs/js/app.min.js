/*! weather-service v1.0.0 | (c) 2021 bnjmnrsh@gmail.com | MIT License | git+ssh://git@github.com/bnjmnrsh-projs/Weather-Service.git */
!function(){"use strict";const e=function(e=""){if("number"==typeof e)return e;if(!e)return;const n=document.createElement("div");return n.innerHTML=e,n.innerText},n=async function(e,n){if(navigator.geolocation)try{return n.debug&&console.log("fGetLocation: Checking geoLoccation API: fGeoLocApi."),await async function(){const e={enableHighAccuracy:!1,timeout:5e3,maximumAge:0},n=new Promise((function(n,t){navigator.geolocation.getCurrentPosition((function(e){n(e.coords)}),(function(e){t(e)}),e)}));return await n}()}catch(t){n.debug&&console.warn("fGetLocationL: failed using fGeoLocApi: ",t);try{return n.debug&&console.warn("Falling back to IP address lookup instead."),await async function(e){const n=await fetch(e).then((function(e){return e.ok?e.json():Promise.reject(e)}));return await n}(e)}catch(e){n.debug&&console.warn("fGetLocation: failed sIpapiLocationApi: ",e)}}},t=async function(n,t,i){const o=await fetch(function(n,t,i){if(!t)return;let o=`${n}&lat=${t.latitude}&lon=${t.longitude}`;if(!t.latitude||!t.longitude){let e,i,a="";"city"in t&&t.city&&(e=`&city=${t.city}`),"state"in t&&t.state&&(i=`&state=${t.state}`),"country"in t&&t.country_code&&(a=`&country=${t.country_code}`),o=`${n}${e??""}${i??""}${a??""}`}return i.debug&&console.log("sApiQuery query:",e(o)),e(o)}(t,n,i)).then((function(e){return e.ok?e.json():Promise.reject(e)}));return await o},i=function(e){if("number"!=typeof e)return 0;let n="none";switch(e=parseFloat(e)){case e<=0?e:null:n=0;break;case e>=0&&e<10?e:null:n=1;break;case e>=10&&e<22?e:null:n=2;break;case e>=22&&e<27?e:null:n=3;break;case e>=27&&e<34?e:null:n=4;break;case e>=34?e:null:n=5}return n},o=function(e){if(!e)return;let n="none";switch(e=parseFloat(e)){case e<1?e:null:n="0";break;case e>=1&&e<3?e:null:n="1";break;case e>=3&&e<5?e:null:n="2";break;case e>=5&&e<7?e:null:n="3";break;case e>=7&&e<9?e:null:n="4";break;case e>=9||e<=10?e:null:n=5}return n},a={200:["wi-day-thunderstorm","wi-night-alt-thunderstorm"],201:["wi-day-thunderstorm","wi-night-alt-thunderstorm"],202:["wi-day-thunderstorm","wi-night-alt-thunderstorm"],230:["wi-day-thunderstorm","wi-night-alt-thunderstorm"],231:["wi-day-thunderstorm","wi-night-alt-thunderstorm"],232:["wi-day-thunderstorm","wi-night-alt-thunderstorm"],233:["wi-day-thunderstorm","wi-night-alt-thunderstorm"],300:["wi-day-rain","wi-night-alt-rain"],301:["wi-day-rain","wi-night-alt-rain"],302:["wi-day-rain","wi-night-alt-rain"],500:["wi-day-rain","wi-night-alt-rain"],501:["wi-day-rain","wi-night-alt-rain"],502:["wi-day-rain-wind","wi-night-alt-rain-wind"],511:["wi-day-sleet","wi-night-alt-sleet"],520:["wi-day-showers","wi-night-alt-showers"],521:["wi-day-showers","wi-night-alt-showers"],522:["wi-day-rain","wi-night-alt-rain"],600:["wi-day-snow","wi-night-alt-snow"],602:["wi-day-snow","wi-night-alt-snow"],610:["wi-day-snow-thunderstorm","wi-night-alt-snow-thunderstorm"],611:["wi-day-snow-wind","wi-night-alt-snow-wind"],612:["wi-day-snow-wind","wi-night-alt-snow-wind"],622:["wi-day-snow-thunderstorm","wi-night-alt-snow-thunderstorm"],623:["wi-day-snow","wi-night-alt-snow"],700:["wi-day-fog","wi-night-fog"],711:["wi-day-fog","wi-night-fog"],721:["wi-day-fog","wi-night-fog"],731:["wi-day-fog","wi-night-fog"],741:["wi-day-fog","wi-night-fog"],751:["wi-day-fog","wi-night-fog"],800:["wi-day-sunny","wi-night-clear"],801:["wi-day-cloudy","wi-night-alt-cloudy"],802:["wi-day-cloudy-high","wi-night-alt-cloudy-high"],803:["wi-day-cloudy-high","wi-night-partly-cloudy"],804:["wi-cloudy","wi-cloudy"],900:["wi-rain-mix","wi-rain-mix"]},r={0:["wi-day-sunny","wi-night-clear"],1:["wi-day-cloudy-high","wi-night-alt-cloudy-high"],2:["wi-day-sunny-overcast","wi-night-partly-cloudy"],3:["wi-cloud","wi-cloud"],4:["wi-cloudy","wi-cloudy"],5:["dark-cloudy","dark-cloudy"]},s=function(n,t){if(!n)return;let i,o;return!t&&Object.prototype.hasOwnProperty.call(n,"pod")?(o="d"===e(n.sPod)?0:1,i=parseInt(e(n.weather.code))):"hour"in n?(o="d"===e(n[t].sPod)?0:1,i=parseInt(e(n[t].weather.code))):(o=1,i=parseInt(e(n.weather.code))),a[i][o]},c=function(e,n={}){if("content"in document.createElement("template")){const t=document.createElement("div");t.innerHTML=e.trim();const i=t.querySelector("div >:first-child");return Object.prototype.hasOwnProperty.call(n,"style")&&i.setAttribute("style",n.style),Object.prototype.hasOwnProperty.call(n,"class")&&i.classList.add(n.class),Object.prototype.hasOwnProperty.call(n,"data")&&Object.keys(n.data).length>0&&Object.keys(n.data).map((e=>i.setAttribute(`data-${e}`,n.data[e]))),t.innerHTML}return""},l=function(e,n){return"number"!=typeof e&&n.debug&&console.warn(`fPercip recieved a non numeric value: ${e} typeof: ${typeof e}`),0===e?e:"M"===n.units?`${parseFloat(e).toFixed(2)}&nbsp;mm/hr`:`${(.0393701*parseFloat(e)).toFixed(2)}&nbsp;inch/hr`},d=function(e,n,t=!0){if("number"!=typeof e&&n.debug&&console.warn(`fTemp recieved a non numeric value: ${e} typeof: ${typeof e}`),"number"!=typeof e)return 0;if("M"===n.units){const n=parseFloat(e).toFixed(1);return t?`${n}°&nbsp;C`:n}{const n=(9*parseFloat(e)/5+32).toFixed(1);return t?`${n}°&nbsp;F`:n}};function u(e){if(e.length>=16)return e.replace(" ","T");const n=`${e}T00:00`;if("function"!=typeof new Date(n).getMonth)throw new Error(`fAddTimeToDateString not provided a string that can be converted to a valid date: "${e}:`);return n}const g=function(e="",n,t=""){let i,o;console.log("sDate",e),i=""!==e?new Date(u(e)):new Date,o=""!==t?t.split(":"):[i.getUTCHours(),i.getUTCMinutes()];const a=[i.getUTCFullYear(),i.getUTCMonth(),i.getUTCDate(),o[0],o[1]],r=new Date(Date.UTC(...a));return!0===n.debug&&(console.log("fGetLocalTime provided sTime24: ",t),console.log("fGetLocalTime UTC converted time:",`${r.getHours()}:${r.getMinutes()}`)),console.log(i),function(e,n){if(!e.includes(":")||"5"===!e.length)throw new Error("fTime not given a valid time string: HH:MM");if("M"===n.units)return e;console.log("sTime24",`${e}`),console.log("sTime24 length",`${e.length}`);const[t,i]=e.match(/([0-9]{1,2}):([0-9]{2})/).slice(1);return`${+t%12||12}:${i}&nbsp;${+t<12?"AM":"PM"}`}(`${r.getHours()}`.padStart(2,"0")+":"+`${r.getMinutes()}`.padStart(2,"0"),n)},w={en:{now:"Currently: ",aira_now:"The weather is currently: ",feels_like:"Feels Like:",uv:"UV:",cloud:"Cloud:",snow:"Snow:",percip:"Rain:",wind:"Wind:",aira_winds:"Winds traveling at",aira_winds_join:"from the",vis:"Visibility:",sun:"Sun:",moon:"Moon:"}},p=function(n,t,i,o=w){const a=t.CURRENT.data[0];return n?n.replace("{{feels_like}}",o.en.feels_like).replace("{{app_temp}}",d(e(a.app_temp),i)).replace("{{uv}}",o.en.uv).replace("{{uv_index}}",e(a.uv.toFixed(2))).replace("{{cloud}}",o.en.cloud).replace("{{cloud_percent}}",`${e(a.clouds)}%`).replace("{{snow}}",o.en.snow).replace("{{snow_percip}}",l(e(a.snow),i)).replace("{{rain}}",o.en.percip).replace("{{rain_percip}}",l(e(a.precip),i)).replace("{{aira_winds}}",o.en.aira_winds).replace("{{aira_winds_join}}",o.en.aira_winds_join).replace("{{wind}}",o.en.wind).replace("{{wind_speed}}",function(e,n){return"number"!=typeof e&&n.debug&&console.warn(`fKmPerHour recieved a non numeric value: ${e} typeof: ${typeof e}`),"number"!=typeof e?0:"M"===n.units?`${(3.6000059687997*parseFloat(e)).toFixed(2)}&nbsp;km/hr`:`${(2.23694*parseFloat(e)).toFixed(2)}&nbsp;mi/hr`}(e(a.wind_spd),i)).replace("{{wind_direction}}",e(a.wind_cdir)).replace("{{vis}}",o.en.vis).replace("{{vis_distance}}",function(e,n){return"number"!=typeof e&&n.debug&&console.warn(`fKm recieved a non numeric value: ${e} typeof: ${typeof e}`),"number"!=typeof e?0:"M"===n.units?`${parseFloat(e).toFixed(2)}&nbsp;km`:`${(.621371*parseFloat(e)).toFixed(2)}&nbsp;miles`}(e(a.vis),i)).replace("{{sun_rise_set}}",o.en.sun).replace("{{sun_rise}}",g(e(a.ob_time),i,e(a.sunrise))).replace("{{sun_set}}",g(e(a.ob_time),i,e(a.sunset))).replace("{{moon}}",o.en.moon):""},h=function(n,t){t.log&&console.log("fRenderHUD: ",n);const o=n.CURRENT.data[0],a=s(o);return function(n,t,i,o=w){const a=t.CURRENT.data[0];return n?n.replace("{{now}}",o.en.now).replace("{{aira_weather_description}}",`${o.en.aira_now} ${e(a.weather.description)}`).replace("{{weather_description}}",e(a.weather.description).toLowerCase()).replace("{{temp}}",d(e(a.temp),i)).replace("{{city}}",e(a.city_name)).replace("{{country}}",e(a.country_code)):""}(`<header\n        id="hud" class="c-hud" data-temp="${i(e(o.temp))}">\n            <h3>\n                <img class="weather-icon" alt="" src="./svg/icons/weather/svg/${a}.svg" />\n                <span aria-hidden="true">{{temp}}</span>\n                </h3>\n                <ul class="unstyled">\n                <li aria-hidden="true">{{now}} {{weather_description}}</li>\n                <li hidden>{{aira_weather_description}}</li>\n                <li>{{city}}, {{country}}</li>\n            </ul>\n        </header>\n        `,n,t)},f=function(n,t){console.log("fRenderForcast: ",n),console.log("_oSettings: ",t);return Object.keys(n).map((function(o){return`<li data-temp="${i(e(n[o].temp))}">\n                        <header datetime="${e(n[o].datetime)}" aria-description="The forecast for">${function(e){const n=new Date(u(e));if(!n||"function"!=typeof n.getMonth)throw new Error("fGetWeekday provided invalid date");return n.toLocaleString("default",{weekday:"short"})}(e(n[o].datetime))} ${function(e){const n=new Date(u(e));if(!n||"function"!=typeof n.getMonth)throw new Error("fFormatDayOrdinal provided invalid date");return n.getDate()+(n.getDate()%10==1&&11!==n.getDate()?"st":n.getDate()%10==2&&12!==n.getDate()?"nd":n.getDate()%10==3&&13!==n.getDate()?"rd":"th")}(e(n[o].datetime))}</header>\n                        <img class="weather-icon" alt="${e(n[o].weather.description)}" src="./svg/icons/weather/svg/${s(n[o])}.svg" />\n                        <p class="forecast-description" aria-hidden="true">${e(n[o].weather.description.toLowerCase())}</p>\n                         <span><stong>${d(e(n[o].high_temp),t)}</stong></span>\n                          <span>${d(e(n[o].low_temp),t)}</span>\n\n                    </li>`})).join("")},m=function(n,t){const a=n.CURRENT.data[0],s=function(e,n="d"){if("number"!=typeof e)return;n="d"===n?0:1;const t=r;let i="";switch(e=parseInt(e)){case e>=0&&e<16?e:null:i=[t[0][n],0];break;case e>=16&&e<32?e:null:i=[t[1][n],1];break;case e>=32&&e<48?e:null:i=[t[2][n],2];break;case e>=48&&e<65?e:null:i=[t[3][n],3];break;case e>=65&&e<83?e:null:i=[t[4][n],4];break;case e>=83&&e<=100?e:null:i=[t[5][n],5]}return i.push(document.querySelector(`#svgs .svg-${i[0]}`).outerHTML),i}(a.clouds),l=function(e,n){const t={phases:["new","waxing-crescent","first-quarter","waxing-gibbous","full","waning-gibbous","third-quarter","waning-crescent"],phase:function(e,n,i){let o=0,a=0,r=0,s=0;return n<3&&(e--,n+=12),o=365.25*e,a=30.6*++n,r=o+a+i-694039.09,r/=29.5305882,s=parseInt(r),r-=s,s=Math.round(r*this.phases.length),s>=8&&(s=0),{phase:s,name:t.phases[s]}}};(e=(e=e||new Date)instanceof String?new Date(e):e)&&"function"==typeof e.getMonth||n.debug&&console.error(`fMoonPhase provided invalid date strings: year: ${e.year}, month: ${e.month}, day: ${e.day}`);const i=e.getFullYear(),o=e.getMonth()+1,a=e.getDate(),r=t.phase(i,o,a);return n.debug&&console.log("fMoonPhase result: ",r),r}(a.obj_time,t),d=t.icon,u=`\n        <div id="details" class="c-details">\n            <ul class="unstyled">\n                <li class="c-feels-like">\n                    <span class="left-col">{{feels_like}} {{app_temp}}</span>\n                    ${c(t.icon.sThermometer,{class:"inline-icon",data:{temp:i(e(a.app_temp))}})}\n                </li>\n                ${a.uv?`<li class="c-uv-index">\n                            <span class="left-col">{{uv}} {{uv_index}}</span>\n                            ${c(t.icon.sSunnyDay,{class:"inline-icon",data:{uv:o(e(a.uv))}})}\n                          </li>`:""}\n                <li class="c-cloud-cover">\n                    <span class="left-col">{{cloud}} {{cloud_percent}}</span>\n                    ${s[2]}\n                </li>\n                ${a.snow?`<li>\n                            <span class="left-col">{{snow}} {{snow_percip}}</span>\n                            ${d.sSnow}\n                          </li>`:""}\n                <li class="c-precipitation">\n                    <span class="left-col">{{rain}} {{rain_percip}}</span>\n                    ${d.sRaindrop}\n                </li>\n                <li class="c-windspeed" aria-description="{{aira_winds}} ">\n                    <span class="left-col">\n                        {{wind}} {{wind_speed}}<span aira-hidden>&nbsp;|&nbsp;</span><span hidden>{{aira_winds_join}}</span>{{wind_direction}}\n                    </span>\n                    <span class="inline-icon">\n                        ${c(d.sWindDirection,{style:`transform: rotate(${e(a.wind_dir+180)}deg)`})}\n                        ${d.sWind}\n                    </span>\n                </li>\n                <li class="c-visibility">\n                    <div class="visibility-wrap">\n                        <span class="left-col">{{vis}} {{vis_distance}}</span>\n                        ${d.sBinoculars}\n                    </div>\n                    <div class="scale" aria-hidden="true"><div class="distance"></div></div>\n                </li>\n                <li class="c-sun-rise-set">\n                    <span class="left-col">{{sun_rise_set}} {{sun_rise}} | {{sun_set}}</span>\n                    ${d.sSunrise}\n                </li>\n                <li class="c-moonphase">\n                    <span class="left-col">{{moon}} ${l.name}</span>\n                    <img class="inline-icon moon"\n                        alt=""\n                        height="25" width="25"\n                        src="./svg/icons/moon/svg/${l.phase}.svg"/>\n                </li>\n            </ul>\n        </div>`;return p(u,n,t)},y=function(e={}){let n=window.localStorage.getItem(e.STORAGE_KEY);return null===n&&(n="dark"===function(e={}){let n=window.getComputedStyle(document.documentElement).getPropertyValue(e.COLOR_MODE_CSS_PROP);return n.length&&(n=n.replace(/"/g,"").trim()),e.debug&&console.log("ThemeToggle:fGetColorModeCSSpropVal: sResponse:",n),n}(e)?"dark":"light",window.localStorage.setItem(e.STORAGE_KEY,n)),e.debug&&console.log("ThemeToggle:fGetLocalStoreColorSchemeVal: sCurrentSetting:",n),n},b=function(e,n={}){"light"!==e&&"dark"!==e||window.localStorage.setItem(n.STORAGE_KEY,e),n.debug&&console.log("ThemeToggle:fSetLocalStoreColorSchemeVal: sCurrentSetting:",e)},v=function(e,n={}){const t=e||y(n);"light"!==t&&"dark"!==t||document.documentElement.setAttribute("data-user-color-scheme",t),n.debug&&console.log("ThemeToggle:fSetHTMLdataAttr: sColorSetting:",e)},T=function(e,n,t={}){switch(e){case"dark":n.setAttribute("aria-pressed","true");break;case"light":n.removeAttribute("aria-pressed")}t.debug&&console.log("ThemeToggle:fSetButtonState: sSetButtonState:",e)},$=function(e,n,t){const i=e||y(t);switch(i){case"light":v("light",t),T("light",n,t),b("light",t);break;case"dark":v("dark",t),T("dark",n,t),b("dark",t)}t.debug&&console.log("ThemeToggle:fSetGlobalColorScheme: sCurrentSetting:",i)},_=function(e,n={}){window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",(function(t){t.matches?$("dark",e,n):$("light",e,n),n.debug&&t.matches&&console.log(`ThemeToggle:fAddEventListeners: Window detected system color pref change: ${t.matches}`)})),document.addEventListener("click",(function(t){t.target.id===e.id&&(!function(e,n={}){const t=y(n);switch(t){case"light":$("dark",e,n);break;case"dark":$("light",e,n)}n.debug&&console.log("ThemeToggle:fToggleGlobalColorScheme: sCurrentSetting:",t)}(e,n),n.debug&&console.log(`ThemeToggle:fAddEventListeners: button "${t.target.id}" clicked.`))}));new window.MutationObserver((function(t){t.forEach((function(t){if(t.attributeName===`data-${n.STORAGE_KEY}`){const t=document.documentElement.getAttribute(`data-${n.STORAGE_KEY}`);T(t,e,n),b(t,n),n.debug&&console.log(`ThemeToggle:fAddEventListeners: MutationObserver change: data-${n.STORAGE_KEY}="${t}"`)}}))})).observe(document.documentElement,{attributeFilter:[`data-${n.STORAGE_KEY}`],attributeOldValue:!0})},S=function(e={}){const n=Object.assign({},{buttonID:"#theme-toggler",debug:!1},e);n.STORAGE_KEY="user-color-scheme",n.COLOR_MODE_CSS_PROP="--color-mode",this.oSettings=n;const t=document.querySelector(n.buttonID);this.init=function(){t?(t.removeAttribute("disabled"),_(t,n),$(y(n),t,n),n.debug&&console.log("ThemeToggle:Init,  current localStore setting: ",window.localStorage.getItem(n.STORAGE_KEY))):console.warn("ThemeToggle: Couldn't find the theme toggel button with selector:",t)}};!function(e={}){document.documentElement.classList.remove("no-js");e=Object.assign({target:"#app",units:"M",debug:!1,dev:!1},e);let i="https://weatherserv.bnjmnrsh.workers.dev/?";!0===e.dev&&(i=`${i}&DEV=true`);const o=document.querySelector(e.target),a=document.querySelector("#svgs");e.icon={sWind:a.querySelector(".svg-wi-strong-wind").outerHTML,sThermometer:a.querySelector(".svg-wi-thermometer").outerHTML,sWindDirection:a.querySelector(".svg-wi-wind-deg").outerHTML,sSnow:a.querySelector(".svg-wi-snow").outerHTML,sRaindrop:a.querySelector(".svg-wi-raindrop").outerHTML,sBinoculars:a.querySelector(".svg-binoculars").outerHTML,sSunrise:a.querySelector(".svg-wi-sunrise").outerHTML,sSunset:a.querySelector(".svg-wi-sunset").outerHTML,sSunnyDay:a.querySelector(".svg-wi-day-sunny").outerHTML};const r=function(n){o.classList.remove("loading"),o.innerHTML=h(n,e)+m(n,e)+function(e,n){return`\n        <div id="forecast" class="c-forecast" aria-description="The weather forecast for the next 16 days.">\n            <ul class="unstyled">\n                ${f(e,n)}\n            </ul>\n        </div>\n        `}(n.DAILY.data,e),function(e){const n=parseFloat(e)/5*100;document.querySelector(".distance").style.setProperty("--distance",100-n+"%")}(n.CURRENT.data[0].vis)};!async function(){try{const o=await n("https://ipapi.co/json/",e),a=await t(o,i,e);e.debug&&(console.log("fGetLocation response:",o),console.log("fGetWeather response:",a)),r(a)}catch(e){console.error("init error: ",e),o.innerHTML=`<div id="ohnos" class="c-screen errors">\n                <h3><span aria-hidden="true">⥀.⥀</span><br>Oh Nooos!</h3>\n                <p class="sr-only">There has been a crittical error:</p>\n                    <div class="errors-wrap">\n                        ${(a=e).stack?"<code>"+a.stack+"</code>":""}\n                        ${a.status?"<code>"+a.statusText+": "+a.status+"</code>":""}\n                    </div>\n                <img alt="" class="screen-icon errors-icon" src="./svg/icons/weather/svg/wi-alien.svg"/>\n            </div>`}var a}();new S({debug:!0}).init()}({units:"I",debug:!0,dev:!1})}();
//# sourceMappingURL=app.min.js.map
