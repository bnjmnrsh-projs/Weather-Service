/*! weather-service v1.0.0 | (c) 2021 bnjmnrsh@gmail.com | MIT License | git+ssh://git@github.com/bnjmnrsh-projs/Weather-Service.git */
!function(){"use strict";const n=function(n=""){if("number"==typeof n)return n;if(!n)return;const e=document.createElement("div");return e.innerHTML=n,e.innerText},e=async function(n,e){if(navigator.geolocation)try{return e.debug&&console.log("fGetLocation: Checking geoLoccation API: fGeoLocApi."),await async function(){const n={enableHighAccuracy:!0,timeout:5e3,maximumAge:0},e=new Promise((function(e,t){navigator.geolocation.getCurrentPosition((function(n){e(n.coords)}),(function(n){t(n)}),n)}));return await e}()}catch(t){e.debug&&console.warn("fGetLocationL: failed using fGeoLocApi: ",t);try{return console.log("5"),e.debug&&console.warn("Falling back to IP address lookup instead."),await async function(n){const e=await fetch(n).then((function(n){return n.ok?n.json():Promise.reject(n)}));return await e}(n)}catch(n){e.debug&&console.warn("fGetLocation: failed sIpapiLocationApi: ",n)}}},t=async function(e,t,i){const a=await fetch(function(e,t,i){if(!t)return;let a=`${e}&lat=${t.latitude}&lon=${t.longitude}`;if(!t.latitude||!t.longitude){let n,i,s="";"city"in t&&t.city&&(n=`&city=${t.city}`),"state"in t&&t.state&&(i=`&state=${t.state}`),"country"in t&&t.country_code&&(s=`&country=${t.country_code}`),a=`${e}${n??""}${i??""}${s??""}`}return i.debug&&console.log("sApiQuery query:",n(a)),n(a)}(t,e,i)).then((function(n){return n.ok?n.json():Promise.reject(n)}));return await a},i=function(n){if("number"!=typeof n)return 0;let e="none";switch(n=parseFloat(n)){case n<=0?n:null:e=0;break;case n>=0&&n<10?n:null:e=1;break;case n>=10&&n<22?n:null:e=2;break;case n>=22&&n<27?n:null:e=3;break;case n>=27&&n<34?n:null:e=4;break;case n>=34?n:null:e=5}return e},a=function(n,e){return"number"!=typeof n&&e.debug&&console.warn(`fPercip recieved a non numeric value: ${n} typeof: ${typeof n}`),0===n?n:"M"===e.units?`${parseFloat(n).toFixed(2)}&nbsp;mm/hr`:`${(.0393701*parseFloat(n)).toFixed(2)}&nbsp;inch/hr`},s=function(n,e,t=!0){if("number"!=typeof n&&e.debug&&console.warn(`fTemp recieved a non numeric value: ${n} typeof: ${typeof n}`),"number"!=typeof n)return 0;if("M"===e.units){let e=parseFloat(n).toFixed(1);return t?`${e}°&nbsp;C`:e}{let e=(9*parseFloat(n)/5+32).toFixed(1);return t?`${e}°&nbsp;F`:e}},o={200:["wi-day-thunderstorm","wi-night-alt-thunderstorm"],201:["wi-day-thunderstorm","wi-night-alt-thunderstorm"],202:["wi-day-thunderstorm","wi-night-alt-thunderstorm"],230:["wi-day-thunderstorm","wi-night-alt-thunderstorm"],231:["wi-day-thunderstorm","wi-night-alt-thunderstorm"],232:["wi-day-thunderstorm","wi-night-alt-thunderstorm"],233:["wi-day-thunderstorm","wi-night-alt-thunderstorm"],300:["wi-day-rain","wi-night-alt-rain"],301:["wi-day-rain","wi-night-alt-rain"],302:["wi-day-rain","wi-night-alt-rain"],500:["wi-day-rain","wi-night-alt-rain"],501:["wi-day-rain","wi-night-alt-rain"],502:["wi-day-rain-wind","wi-night-alt-rain-wind"],511:["wi-day-sleet","wi-night-alt-sleet"],520:["wi-day-showers","wi-night-alt-showers"],521:["wi-day-showers","wi-night-alt-showers"],522:["wi-day-rain","wi-night-alt-rain"],600:["wi-day-snow","wi-night-alt-snow"],602:["wi-day-snow","wi-night-alt-snow"],610:["wi-day-snow-thunderstorm","wi-night-alt-snow-thunderstorm"],611:["wi-day-snow-wind","wi-night-alt-snow-wind"],612:["wi-day-snow-wind","wi-night-alt-snow-wind"],622:["wi-day-snow-thunderstorm","wi-night-alt-snow-thunderstorm"],623:["wi-day-snow","wi-night-alt-snow"],700:["wi-day-fog","wi-night-fog"],711:["wi-day-fog","wi-night-fog"],721:["wi-day-fog","wi-night-fog"],731:["wi-day-fog","wi-night-fog"],741:["wi-day-fog","wi-night-fog"],751:["wi-day-fog","wi-night-fog"],800:["wi-day-sunny","wi-night-clear"],801:["wi-day-cloudy","wi-night-alt-cloudy"],802:["wi-day-cloudy-high","wi-night-alt-cloudy-high"],803:["wi-day-cloudy-high","wi-night-partly-cloudy"],804:["wi-cloudy","wi-cloudy"],900:["wi-rain-mix","wi-rain-mix"]},r={0:["wi-day-sunny","wi-night-clear"],1:["wi-day-cloudy-high","wi-night-alt-cloudy-high"],2:["wi-day-sunny-overcast","wi-night-partly-cloudy"],3:["wi-cloud","wi-cloud"],4:["wi-cloudy","wi-cloudy"],5:["dark-cloudy","dark-cloudy"]},c=function(e,t){if(!e)return;let i,a;return!t&&e.hasOwnProperty("pod")?(a="d"===n(e.sPod)?0:1,i=parseInt(n(e.weather.code))):"hour"in e?(a="d"===n(e[t].sPod)?0:1,i=parseInt(n(e[t].weather.code))):(a=1,i=parseInt(n(e.weather.code))),o[i][a]},l=function(e,t,i){return e?e.replace("{{forcast}}",n(t.weather.description)).replace("{{temp}}",s(n(t.temp),i)).replace("{{city}}",n(t.city_name)).replace("{{country}}",n(t.country_code)):""};function u(n){if(n.length>=16)return n;const e=`${n} 00:00`;if("function"!=typeof new Date(e).getMonth)throw new Error(`fAddTimeToDateString not provided a string that can be converted to a valid date: "${n}:`);return e}const d=function(n="",e,t=""){let i,a;i=""!==n?new Date(u(n)):new Date,a=""!=t?t.split(":"):[i.getUTCHours(),i.getUTCMinutes()];const s=new Date(Date.UTC(i.getUTCFullYear(),i.getUTCMonth(),i.getUTCDate(),a[0],a[1]));return!0===e.debug&&(console.log("fGetLocalTime provided sTime24: ",t),console.log("fGetLocalTime UTC converted time:",`${s.getHours()}:${s.getMinutes()}`)),function(n,e){if(!n.includes(":")||"5"==!n.length)throw new Error("fTime not given a valid time string: HH:MM");if("M"===e.units)return n;const[t,i]=n.match(/([0-9]{1,2}):([0-9]{2})/).slice(1);return`${+t%12||12}:${i}&nbsp;${+t<12?"AM":"PM"}`}(`${s.getHours()}:${s.getMinutes()}`,e)},w=function(e,t){console.log("fRenderForcast: ",e),console.log("_oSettings: ",t);return Object.keys(e).map((function(a){return`<li data-temp="${i(n(e[a].temp))}">\n                        <header datetime="${n(e[a].datetime)}" aria-description="The forcast for">${function(n){console.log("fGetWeekday:",n);const e=new Date(u(n));if(console.log("fGetWeekday fAddTimeToDateString",u(n)),console.log("fGetWeekday: oDate",e),!e||"function"!=typeof e.getMonth)throw new Error("fGetWeekday provided invalid date");return e.toLocaleString("default",{weekday:"short"})}(n(e[a].datetime))} ${function(n){const e=new Date(u(n));if(!e||"function"!=typeof e.getMonth)throw new Error("fFormatDayOrdinal provided invalid date");return e.getDate()+(e.getDate()%10==1&&11!=e.getDate()?"st":e.getDate()%10==2&&12!=e.getDate()?"nd":e.getDate()%10==3&&13!=e.getDate()?"rd":"th")}(n(e[a].datetime))}</header>\n                        <img class="weather-icon" alt="${n(e[a].weather.description)}" src="./svg/icons/weather/svg/${c(e[a])}.svg" />\n                        <p class="_oForecast-description" aria-hidden="true">${n(e[a].weather.description.toLowerCase())}</p>\n                         <span><stong>${s(n(e[a].high_temp),t)}</stong></span>\n                          <span>${s(n(e[a].low_temp),t)}</span>\n\n                    </li>`})).join("")},g=function(e,t){const o=n(e.wind_cdir_full),c=n(e.wind_dir),l=function(n,e="d"){if("number"!=typeof n)return;e=e=0;const t=r;let i="";switch(n=parseInt(n)){case n>=0&&n<16?n:null:i=[t[0][e],0];break;case n>=16&&n<32?n:null:i=[t[1][e],1];break;case n>=32&&n<48?n:null:i=[t[2][e],2];break;case n>=48&&n<65?n:null:i=[t[3][e],3];break;case n>=65&&n<83?n:null:i=[t[4][e],4];break;case n>=83&&n<=100?n:null:i=[t[5][e],5]}return i.push(document.querySelector(`#svgs .svg-${i[0]}`).outerHTML),i}(e.clouds),u=function(n,e){const t={phases:["new","waxing-crescent","first-quarter","waxing-gibbous","full","waning-gibbous","third-quarter","waning-crescent"],phase:function(n,e,i){let a=0,s=0,o=0,r=0;return e<3&&(n--,e+=12),a=365.25*n,s=30.6*++e,o=a+s+i-694039.09,o/=29.5305882,r=parseInt(o),o-=r,r=Math.round(o*this.phases.length),r>=8&&(r=0),{phase:r,name:t.phases[r]}}};(n=(n=n||new Date)instanceof String?new Date(n):n)&&"function"==typeof n.getMonth||e.debug&&console.error(`fMoonPhase provided invalid date strings: year: ${year}, month: ${month}, day: ${day}`);const i=n.getFullYear(),a=n.getMonth()+1,s=n.getDate(),o=t.phase(i,a,s);return e.debug&&console.log("fMoonPhase result: ",o),o}(e.obj_time,t);return`\n        <div id="details">\n            <ul class="unstyled">\n                <li class="feels-like">\n                <span class="left-col">Feels like:\n                    ${s(n(e.app_temp),t)}\n                </span>\n                <svg alt="" height="25" width="25" class="inline-icon svg-wi-thermometer" data-temp="${i(n(e.app_temp))}" enable-background="new 0 0 30 30" viewBox="0 0 30 30" xmlns="http://www.w3.org/2000/svg"><path d="m9.91 19.56c0-.85.2-1.64.59-2.38s.94-1.35 1.65-1.84v-9.92c0-.8.27-1.48.82-2.03s1.23-.84 2.03-.84c.81 0 1.49.28 2.04.83.55.56.83 1.23.83 2.03v9.92c.71.49 1.25 1.11 1.64 1.84s.58 1.53.58 2.38c0 .92-.23 1.78-.68 2.56s-1.07 1.4-1.85 1.85-1.63.68-2.56.68c-.92 0-1.77-.23-2.55-.68s-1.4-1.07-1.86-1.85-.68-1.63-.68-2.55zm1.76 0c0 .93.33 1.73.98 2.39s1.44.99 2.36.99c.93 0 1.73-.33 2.4-1s1.01-1.46 1.01-2.37c0-.62-.16-1.2-.48-1.73s-.76-.94-1.32-1.23l-.28-.14c-.1-.04-.15-.14-.15-.29v-10.76c0-.32-.11-.59-.34-.81-.23-.21-.51-.32-.85-.32-.32 0-.6.11-.83.32s-.34.48-.34.81v10.74c0 .15-.05.25-.14.29l-.27.14c-.55.29-.98.7-1.29 1.23s-.46 1.1-.46 1.74zm.78 0c0 .71.24 1.32.73 1.82s1.07.75 1.76.75 1.28-.25 1.79-.75.76-1.11.76-1.81c0-.63-.22-1.19-.65-1.67s-.96-.77-1.58-.85v-7.36c0-.06-.03-.13-.1-.19-.07-.07-.14-.1-.22-.1-.09 0-.16.03-.21.08-.05.06-.08.12-.08.21v7.34c-.61.09-1.13.37-1.56.85-.43.49-.64 1.04-.64 1.68z"/></svg>\n                ${e.uv?'<li class="uv-index"><span class="left-col">UV Index: '+n(e.uv.toFixed(2))+'</span><svg alt="" height="25" width="25" class="inline-icon svg-wi-day-sunny" data-uv="'+function(n){if(!n)return;let e="none";switch(n=parseFloat(n)){case n<1?n:null:e="0";break;case n>=1&&n<3?n:null:e="1";break;case n>=3&&n<5?n:null:e="2";break;case n>=5&&n<7?n:null:e="3";break;case n>=7&&n<9?n:null:e="4";break;case n>=9||n<=10?n:null:uvClass=5}return e}(n(e.uv))+'" enable-background="new 0 0 30 30" viewBox="0 0 30 30" xmlns="http://www.w3.org/2000/svg"><path d="m4.4 14.9c0-.2.1-.4.2-.6.2-.2.4-.2.6-.2h2c.2 0 .4.1.6.2.2.2.2.4.2.6s0 .5-.2.6c-.2.2-.3.2-.6.2h-2c-.2 0-.4-.1-.6-.2-.1-.1-.2-.3-.2-.6zm2.8 6.9c0-.2.1-.4.2-.6l1.5-1.4c.1-.2.4-.2.6-.2s.4.1.6.2.2.3.2.6c0 .2-.1.5-.2.6l-1.4 1.4c-.4.3-.8.3-1.2 0-.2-.1-.3-.3-.3-.6zm0-13.8c0-.2.1-.4.2-.6.2-.2.4-.2.6-.2s.4.1.6.2l1.4 1.5c.2.1.2.4.2.6s-.1.4-.2.6-.4.2-.6.2-.4-.1-.6-.2l-1.3-1.5c-.2-.1-.3-.4-.3-.6zm2.6 6.9c0-.9.2-1.8.7-2.6s1.1-1.4 1.9-1.9 1.7-.7 2.6-.7c.7 0 1.4.1 2 .4s1.2.6 1.7 1.1.8 1 1.1 1.7c.3.6.4 1.3.4 2 0 .9-.2 1.8-.7 2.6s-1.1 1.4-1.9 1.9-1.7.7-2.6.7-1.8-.2-2.6-.7-1.4-1.1-1.9-1.9-.7-1.6-.7-2.6zm1.7 0c0 1 .3 1.8 1 2.5s1.5 1 2.5 1 1.8-.4 2.5-1 1-1.5 1-2.5-.4-1.8-1-2.5c-.7-.7-1.5-1-2.5-1s-1.8.3-2.5 1-1 1.6-1 2.5zm2.6 7.8c0-.2.1-.4.2-.6s.4-.2.6-.2.4.1.6.2.2.4.2.6v2c0 .2-.1.5-.2.6s-.4.2-.6.2-.4-.1-.6-.2c-.2-.2-.2-.4-.2-.6zm0-15.5v-2c0-.2.1-.4.2-.6s.4-.3.6-.3.4.1.6.2.2.4.2.6v2.1c0 .2-.1.4-.2.6s-.3.2-.5.2-.4-.1-.6-.2-.3-.4-.3-.6zm5.6 13.2c0-.2.1-.4.2-.6s.3-.2.6-.2c.2 0 .4.1.6.2l1.5 1.4c.2.2.2.4.2.6s-.1.4-.2.6c-.4.3-.8.3-1.2 0l-1.5-1.4c-.2-.2-.2-.4-.2-.6zm0-10.9c0-.2.1-.4.2-.6l1.4-1.5c.2-.2.4-.2.6-.2s.4.1.6.2c.2.2.2.4.2.6s-.1.5-.2.6l-1.5 1.5c-.2.2-.4.2-.6.2s-.4-.1-.6-.2-.1-.4-.1-.6zm2.2 5.4c0-.2.1-.4.2-.6.2-.2.4-.2.6-.2h2c.2 0 .4.1.6.3s.3.4.3.6-.1.4-.3.6-.4.2-.6.2h-2c-.2 0-.4-.1-.6-.2s-.2-.4-.2-.7z"/></svg>':""}\n                <li class="cloud-cover"><span class="left-col">Cloud:\n                    ${n(e.clouds)}% </span>\n                    ${l[2]}\n                ${e.snow?'<li><span class="left-col">Snow: '+a(n(e.snow),t)+"</span>"+t.nSnow+"</li>":""}\n                <li class="precipitation">\n                    <span class="left-col">Precip:\n                          ${a(n(e.precip),t)}\n                          </span>${t.nRaindrop}\n                </li>\n                <li class="windspeed"><span class="left-col">\n                    <span aria-description="Winds traveling from ${o}">\n                        Windspeed:\n                        ${function(n,e){return"number"!=typeof n&&e.debug&&console.warn(`fKmPerHour recieved a non numeric value: ${n} typeof: ${typeof n}`),"number"!=typeof n?0:"M"===e.units?`${(3.6000059687997*parseFloat(n)).toFixed(2)}&nbsp;km/hr`:`${(2.23694*parseFloat(n)).toFixed(2)}&nbsp;mi/hr`}(n(e.wind_spd),t)}&nbsp;|&nbsp;${n(e.wind_cdir)}\n                    </span></span>\n                    <span class="inline-icon">\n                        <svg alt="" height="25" width="25" class="compass"  style="transform: rotate(${c}deg)" enable-background="new 0 0 30 30" viewBox="0 0 30 30" xmlns="http://www.w3.org/2000/svg"><path d="m3.74 14.5c0-2.04.51-3.93 1.52-5.66s2.38-3.1 4.11-4.11 3.61-1.51 5.64-1.51c1.52 0 2.98.3 4.37.89s2.58 1.4 3.59 2.4 1.81 2.2 2.4 3.6.89 2.85.89 4.39c0 1.52-.3 2.98-.89 4.37s-1.4 2.59-2.4 3.59-2.2 1.8-3.59 2.39-2.84.89-4.37.89-3-.3-4.39-.89-2.59-1.4-3.6-2.4-1.8-2.2-2.4-3.58-.88-2.84-.88-4.37zm2.48 0c0 2.37.86 4.43 2.59 6.18 1.73 1.73 3.79 2.59 6.2 2.59 1.58 0 3.05-.39 4.39-1.18s2.42-1.85 3.21-3.2 1.19-2.81 1.19-4.39-.4-3.05-1.19-4.4-1.86-2.42-3.21-3.21-2.81-1.18-4.39-1.18-3.05.39-4.39 1.18-2.42 1.86-3.22 3.21-1.18 2.82-1.18 4.4zm4.89 5.85 3.75-13.11c.01-.1.06-.15.15-.15s.14.05.15.15l3.74 13.11c.04.11.03.19-.02.25s-.13.06-.24 0l-3.47-1.3c-.1-.04-.2-.04-.29 0l-3.5 1.3c-.1.06-.17.06-.21 0s-.08-.15-.06-.25z"/></svg>\n                        ${t.nWind}\n                    </span>\n                </li>\n                <li class="visibility">\n                    <div class="visibility-wrap">\n                        <span class="left-col">Visibility:\n                          ${function(n,e){return"number"!=typeof n&&e.debug&&console.warn(`fKm recieved a non numeric value: ${n} typeof: ${typeof n}`),"number"!=typeof n?0:"M"===e.units?`${parseFloat(n).toFixed(2)}&nbsp;km`:`${(.621371*parseFloat(n)).toFixed(2)}&nbsp;miles`}(n(e.vis),t)}\n                        </span>\n                        ${t.nBinoculars}\n                    </div>\n                    <div class="visibility-graph" aria-hidden="true"><div class="distance"></div></div>\n                </li>\n                <li class="sun-up-down">\n                    <span class="left-col">\n                        ${d(n(e.ob_time),t,n(e.sunrise))}\n                        |\n                        ${d(n(e.ob_time),t,n(e.sunset))}\n                    </span>\n                    ${t.nSunrise}\n                </li>\n                <li class="moonphase">\n                    <span class="left-col">Moon: ${u.name}</span>\n                    <img class="inline-icon moon"\n                        alt=""\n                        height="25" width="25"\n                        src="./svg/icons/moon/svg/${u.phase}.svg"/>\n                </li>\n            </ul>\n        </div>\n        `};!function(a={}){const o={target:"#app",KEY:"",units:"M",forcast:"{{forcast}}",airaForcast:"The weather is currently: {{forcast}} at {{temp}}.",location:"{{city}}, {{country}}",debug:!1};a=Object.assign(o,a);let r="https://weatherserv.bnjmnrsh.workers.dev/?";!0===a.dev&&(r=`${r}&DEV=true`);const u=document.querySelector(a.target),d=document.querySelector("#svgs");a.nWind=d.querySelector(".svg-wi-strong-wind").outerHTML,a.nSnow=d.querySelector(".svg-wi-snow").outerHTML,a.nRaindrop=d.querySelector(".svg-wi-raindrop").outerHTML,a.nBinoculars=d.querySelector(".svg-binoculars").outerHTML,a.nSunrise=d.querySelector(".svg-wi-sunrise").outerHTML,a.nSunset=d.querySelector(".svg-wi-sunset").outerHTML;const h=function(e){app.innerHTML=function(e,t){console.log("fRenderHUD: ",e);const a=c(e);return`\n        <header id="hud" class="" data-temp="${i(e.temp)}">\n            <h3>\n                    <img class="weather-icon" alt="${l(t.airaForcast,e,t)}" src="./svg/icons/weather/svg/${a}.svg" />\n                <span aria-hidden="true">${s(n(e.temp),t)}</span>\n            </h3>\n            <ul class="unstyled">\n                <li aria-hidden="true">\n                    ${l(t.forcast,e,t).toLowerCase()}\n                </li>\n                <li>\n                    ${l(t.location,e,t)}\n                </li>\n            </ul>\n        </header>\n        `}(e.CURRENT.data[0],a)+g(e.CURRENT.data[0],a)+function(n,e){return`\n        <div id="forcast" aria-description="The weather forcast for the next 16 days.">\n            <ul class="unstyled">\n                ${w(n,e)}\n            </ul>\n        </div>\n        `}(e.DAILY.data,a),function(n){const e=parseFloat(n)/5*100;app.querySelector(".distance").style.setProperty("--distance",100-e+"%")}(e.CURRENT.data[0].vis)};!async function(){try{const n=await e("https://ipapi.co/json/",a),i=await t(n,r,a);a.debug&&console.log("fGetLocation response:",n),a.debug&&console.log("fGetWeather response:",i),h(i)}catch(e){console.error("init error: ",e),u.innerHTML=`<div id="hud">\n                <div id="ohnos">\n                    <h3><span aria-hidden="true">⥀.⥀<br /></span>Oh Nooos!</h3>\n                    <p class="sr-only">There has been a crittical error:</p>\n                        <div>\n                            ${(n=e).stack?"<pre>"+n.stack+"<pre>":""}\n                            ${n.status?"<pre>"+n.statusText+": "+n.status+"<pre>":""}\n                        </div>\n                    <img alt="" src="./svg/icons/weather/svg/wi-alien.svg"/>\n                </div>\n            </div>`}var n}()}({forcast:"Currently: {{forcast}}",units:"I",debug:!0,dev:!1})}();
//# sourceMappingURL=app.min.js.map
